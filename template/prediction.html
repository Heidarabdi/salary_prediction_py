{% extends 'Base.html'%}
{% block content%}
{% if messages %}

{% for message in messages %}
{% if message.tags %}  <script>alert("{{ message }}")</script> {% endif %}

{% endfor %}

{% endif %}
<style>
        .box {
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 50px;
}

.box > div { /*The > denotes only the first or immediate child will be affected*/
  width: 800px;
  height: auto;
  /*border: dotted;
*/
  background-color: #E5DDC5;
  border-radius: 5px
}

.box > div label{
    
}


</style>

<div style="background-image:  url(); background-repeat:no-repeat;background-size:cover;  min-height:650px; width:100%;height: auto;">
  <div style="height:10px;background-color: orange;">
  
</div>
  <header>
    <h1>Prediction</h1>
  </header>
    <div class="box">
        <div class="shadow-lg p-3 mb-5 ">
             <div style="text-align: center;"><h3 >Inputs for Prediction</h3> </div>
            <hr class="border border-primary border-3 opacity-75">
            <form method="POST" action="/prediction/" enctype="multipart/form-data" style="padding:25px;" onsubmit="return validateForm()">
{#                {% csrf_token %}#}

              <label class="form-label">Name</label>
              <input class="form-control" type="text" name="name">
              <br>

              <label class="form-label">Job Title</label>
              <select class="form-select" for="job_title" name="job_title">
                  {% for job in jb_title %}
                    <option value="{{ job }}">{{ job }}</option>
                    {% endfor %}
              </select>
              <br>

              <label class="form-label" for="gender">Gender:</label>
                <select class="form-select" id="gender" name="gender">
                    {% for ge in gender %}
                        {% if ge != 'Other' %}
                        <option value="{{ ge }}">{{ ge }}</option>
                        {% endif %}
                    {% endfor %}
                </select><br><br>

                <label class="form-label" for="age">Age:</label>
                <input class="form-control" type="number" id="age" name="age" min="18" max="60"><br><br>

                <label class="form-label" for="education">Education Level:</label>
                <select class="form-select" id="education" name="education">
                    {% for edu in education %}
                        <option value="{{ edu }}">{{ edu }}</option>
                    {% endfor %}
                </select><br><br>


                <label class="form-label" for="years_of_experience">Years of Experience:</label>
                <input class="form-control" type="number" id="years_of_experience" name="years_of_experience" min="0" max="40"><br><br>
         
            <div style="text-align: center;">
              <button style="width:50%" type="submit" class="btn btn-primary">Predict</button>
            </div>
              <br>
            </form>
        {% if prediction %}
{#            Modal #}
            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Salary Prediction</h5>
            </div>
            <div class="modal-body">
                <h4 style="text-align: center;">The predicted salary is <span style="color: green;">${{ prediction }}</span></h4>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="window.location.href='/prediction/'">Close</button>
            </div>
            </div>
            </div>
            </div>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const myModal = new bootstrap.Modal(document.getElementById('exampleModalCenter'), {
                    keyboard: false
                });
                myModal.show();
            });
            </script>
        {% endif %}

    </div>
</div>


    <script>
        function validateForm() {
  const age = Number(document.getElementById('age').value);
  const years_of_experience = Number(document.getElementById('years_of_experience').value);
  const education = document.getElementById('education').value;

  // Check if fields are not empty
  if (!age || !years_of_experience || !education) {
    alert('Please fill out all fields.');
    return false;
  }

  // Ensure age and years_of_experience are numbers and within a realistic range
  if (isNaN(age) || age <= 0 || age > 100) {
    alert('Please enter a valid age between 1 and 100.');
    return false;
  }

  if (isNaN(years_of_experience) || years_of_experience < 0) {
    alert('Please enter a valid number of years of experience.');
    return false;
  }

  // Ensure years of experience is not more than age
  if (years_of_experience > age) {
    alert('Years of experience cannot exceed age.');
    return false;
  }

  // Ensure starting age is at least 18
  const startingAge = age - years_of_experience;
  if (startingAge < 18) {
    alert('The difference between age and years of experience must be at least 18.');
    return false;
  }

  // Define age and experience requirements
  const rules = {
    'PhD': [
      { minAge: 30, maxAge: 40, minExperience: 5 },
      { minAge: 40, maxAge: 50, minExperience: 8 },
      { minAge: 50, maxAge: 60, minExperience: 10 }
    ],
    "Master's Degree": [
      { minAge: 25, maxAge: 35, minExperience: 3 },
      { minAge: 35, maxAge: 45, minExperience: 6 },
      { minAge: 45, maxAge: 55, minExperience: 8 },
      { minAge: 55, maxAge: 60, minExperience: 10 }
    ],
    "Bachelor's Degree": [
      { minAge: 22, maxAge: 32, minExperience: 2 },
      { minAge: 32, maxAge: 42, minExperience: 5 },
      { minAge: 42, maxAge: 52, minExperience: 7 },
      { minAge: 52, maxAge: 60, minExperience: 9 }
    ],
    'High School': [
      { minAge: 18, maxAge: 28, minExperience: 1 },
      { minAge: 28, maxAge: 38, minExperience: 3 },
      { minAge: 38, maxAge: 48, minExperience: 5 },
      { minAge: 48, maxAge: 60, minExperience: 7 }
    ]
  };

  // Ensure a valid education level is selected
  if (!rules[education]) {
    alert('Please select a valid education level.');
    return false;
  }

  // Check for minimum age requirement
  if (age < rules[education][0].minAge) {
    alert(`Age must be greater than ${rules[education][0].minAge}`);
    return false;
  }

  // Validate against experience rules based on age
  for (const rule of rules[education]) {
    if (age >= rule.minAge && age <= rule.maxAge) {
      if (years_of_experience < rule.minExperience) {
        alert(`Years of experience must be greater than ${rule.minExperience}`);
        return false;
      }
    }
  }

  // Form is valid
  return true;
}

    </script>


{% endblock %}